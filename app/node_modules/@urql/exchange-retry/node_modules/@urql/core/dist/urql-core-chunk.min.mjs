import{GraphQLError as e,Kind as r,print as t,parse as n}from"graphql";import{make as a}from"wonka";var o=r=>r instanceof e?r:"object"==typeof r&&r.message?new e(r.message,r.nodes,r.source,r.positions,r.path,r,r.extensions||{}):new e(r);class s extends Error{constructor(e){var r=(e.graphQLErrors||[]).map(o),t=((e,r)=>{var t="";if(e)return`[Network] ${e.message}`;if(r)for(var n of r)t&&(t+="\n"),t+=`[GraphQL] ${n.message}`;return t})(e.networkError,r);super(t),this.name="CombinedError",this.message=t,this.graphQLErrors=r,this.networkError=e.networkError,this.response=e.response}toString(){return this.message}}var i=(e,r)=>{for(var t="number"==typeof r?0|r:5381,n=0,a=0|e.length;n<a;n++)t=(t<<5)+t+e.charCodeAt(n);return t},l=new Set,f=new WeakMap,c=e=>{if(null===e||l.has(e))return"null";if("object"!=typeof e)return JSON.stringify(e)||"";if(e.toJSON)return c(e.toJSON());if(Array.isArray(e)){var r="[";for(var t of e)"["!==r&&(r+=","),r+=(t=c(t)).length>0?t:"null";return r+"]"}var n=Object.keys(e).sort();if(!n.length&&e.constructor&&e.constructor!==Object){var a=f.get(e)||Math.random().toString(36).slice(2);return f.set(e,a),`{"__key":"${a}"}`}l.add(e);var o="{";for(var s of n){var i=c(e[s]);i&&(o.length>1&&(o+=","),o+=c(s)+":"+i)}return l.delete(e),o+"}"},p=e=>(l.clear(),c(e)),u=/("{3}[\s\S]*"{3}|"(?:\\.|[^"])*")/g,d=/(#[^\n\r]+)?(?:\n|\r\n?|$)+/g,h=(e,r)=>r%2==0?e.replace(d,"\n"):e,v=e=>e.split(u).map(h).join("").trim(),y=new Map,x=new Map,g=e=>{var r;return"string"==typeof e?r=v(e):e.loc&&x.get(e.__key)===e?r=e.loc.source.body:(r=y.get(e)||v(t(e)),y.set(e,r)),"string"==typeof e||e.loc||(e.loc={start:0,end:r.length,source:{body:r,name:"gql",locationOffset:{line:1,column:1}}}),r},m=e=>{var r=i(g(e));if("object"==typeof e&&"definitions"in e){var t=N(e);t&&(r=i(`\n# ${t}`,r))}return r},b=e=>{var r,t;return"string"==typeof e?(r=m(e),t=x.get(r)||n(e,{noLocation:!0})):(r=e.__key||m(e),t=x.get(r)||e),t.loc||g(t),t.__key=r,x.set(r,t),t},w=(e,r)=>{r||(r={});var t=b(e),n=p(r),a=t.__key;return"{}"!==n&&(a=i(n,a)),{key:a,query:t,variables:r}},N=e=>{for(var t of e.definitions)if(t.kind===r.OPERATION_DEFINITION&&t.name)return t.name.value},O=e=>{for(var t of e.definitions)if(t.kind===r.OPERATION_DEFINITION)return t.operation},k=(e,r,t)=>{if(!("data"in r)&&!("errors"in r)||"incremental"in r)throw new Error("No Content");var n="subscription"===e.kind;return{operation:e,data:r.data,error:Array.isArray(r.errors)?new s({graphQLErrors:r.errors,response:t}):void 0,extensions:"object"==typeof r.extensions&&r.extensions||void 0,hasNext:null==r.hasNext?n:r.hasNext}},E=(e,r,t)=>{var n,a=!!e.extensions||!!r.extensions,o={...e.extensions,...r.extensions},i=e.error?e.error.graphQLErrors:[],l=r.incremental;if("path"in r&&(l=[{data:r.data,path:r.path}]),l)for(var f of(n={...e.data},l)){Array.isArray(f.errors)&&i.push(...f.errors),f.extensions&&(Object.assign(o,f.extensions),a=!0);for(var c=f.path[0],p=n,u=1,d=f.path.length;u<d;c=f.path[u++])p=p[c]=Array.isArray(p[c])?[...p[c]]:{...p[c]};if(Array.isArray(f.items))for(var h=+c>=0?c:0,v=0,y=f.items.length;v<y;v++)p[h+v]=f.items[v];else void 0!==f.data&&(p[c]=p[c]&&f.data?{...p[c],...f.data}:f.data)}else n=r.data||e.data;return{operation:e.operation,data:n,error:i.length?new s({graphQLErrors:i,response:t}):void 0,extensions:a?o:void 0,hasNext:!!r.hasNext}},S=(e,r,t)=>({operation:e,data:void 0,error:new s({networkError:r,response:t}),extensions:void 0});function A(e){return{query:g(e.query),operationName:N(e.query),variables:e.variables||void 0,extensions:void 0}}var j=(e,r)=>{var t="query"===e.kind&&e.context.preferGetMethod;if(!t||!r)return e.context.url;var n=new URL(e.context.url),a=n.searchParams;r.operationName&&a.set("operationName",r.operationName),r.query&&a.set("query",r.query),r.variables&&a.set("variables",p(r.variables)),r.extensions&&a.set("extensions",p(r.extensions));var o=n.toString();return o.length>2047&&"force"!==t?(e.context.preferGetMethod=!1,e.context.url):o},q=(e,r)=>{var t="query"===e.kind&&!!e.context.preferGetMethod,n={accept:"multipart/mixed, application/graphql-response+json, application/graphql+json, application/json"};t||(n["content-type"]="application/json");var a=("function"==typeof e.context.fetchOptions?e.context.fetchOptions():e.context.fetchOptions)||{};if(a.headers)for(var o in a.headers)n[o.toLowerCase()]=a.headers[o];return{...a,body:!t&&r?JSON.stringify(r):void 0,method:t?"GET":"POST",headers:n}},T="undefined"!=typeof TextDecoder?new TextDecoder:null,_=/content-type:[^\r\n]*application\/json/i,I=/boundary="?([^=";]+)"?/i,L=(e,r,t)=>{var n="manual"===t.redirect?400:300,o=e.context.fetch;return a((({next:a,complete:s})=>{var i="undefined"!=typeof AbortController?new AbortController:null;i&&(t.signal=i.signal);var l,f=!1,c=!1,p=!1;return Promise.resolve().then((()=>{if(!c)return(o||fetch)(r,t)})).then((r=>{if(r)return p=(l=r).status<200||l.status>=n,((e,r,t)=>{var n=t.headers&&t.headers.get("Content-Type")||"";if(/text\//i.test(n))return t.text().then((n=>{e(S(r,new Error(n),t))}));if(!/multipart\/mixed/i.test(n))return t.text().then((n=>{e(k(r,JSON.parse(n),t))}));var a,o="---",s=n.match(I);s&&(o="--"+s[1]);var i=()=>{};if(t[Symbol.asyncIterator]){var l=t[Symbol.asyncIterator]();a=l.next.bind(l)}else{if(!("body"in t)||!t.body)throw new TypeError("Streaming requests unsupported");var c=t.body.getReader();i=()=>c.cancel(),a=()=>c.read()}var p="",u=!0,d=null,h=null;return a().then((function n(s){if(s.done)f=!0;else{var i="Buffer"===(b=s.value).constructor.name?b.toString():T.decode(b),l=i.indexOf(o);for(l>-1?l+=p.length:l=p.indexOf(o),p+=i;l>-1;){var c=p.slice(0,l),v=p.slice(l+o.length);if(u)u=!1;else{var y=c.indexOf("\r\n\r\n")+4,x=c.slice(0,y),g=c.slice(y,c.lastIndexOf("\r\n")),m=void 0;if(_.test(x))try{m=JSON.parse(g),d=h=h?E(h,m,t):k(r,m,t)}catch(e){}if("--"===v.slice(0,2)||m&&!m.hasNext){if(!h)return e(k(r,{},t));break}}l=(p=v).indexOf(o)}}var b;if(d&&(e(d),d=null),!s.done&&(!h||h.hasNext))return a().then(n)})).finally(i)})(a,e,l)})).then(s).catch((r=>{if(f)throw r;var t=S(e,p&&l.statusText?new Error(l.statusText):r,l);a(t),s()})),()=>{c=!0,i&&i.abort()}}))};export{s as C,S as a,A as b,j as c,q as d,L as e,w as f,O as g,p as h,E as i,N as j,b as k,k as m,g as s};
//# sourceMappingURL=urql-core-chunk.min.mjs.map
